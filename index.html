<script>
  // デフォルトの問題バンク（模範解答・骨子付き）
  let questions = [
    {
      era:"近代",
      topic:"外交",
      text:"日清戦争と日露戦争の意義を比較しつつ、日本の国際的地位の変化について論じなさい。",
      model:"日清戦争で清に勝利した日本は下関条約により賠償金と領土を得たが、三国干渉により制約を受けた。日露戦争の勝利では列強の一員として認められ、国際的地位を飛躍的に高めた。両戦争を比較すると、東アジアでの勢力拡大と国際的承認の契機となった点に意義がある。",
      outline:"①日清戦争の成果と制約\n②日露戦争の勝利\n③ポーツマス条約の意義\n④列強からの承認\n⑤国際的地位の確立"
    },
    // ...（省略：他の問題も同様）
  ];

  // ランダム文字数
  function getRandomLength(){
    const lengths = [100,200,400,600];
    return lengths[Math.floor(Math.random()*lengths.length)];
  }

  // フォールバック：テンプレ生成
  function autoGenerateAnswer(era, topic, length, text) {
    const model = `${era}の${topic}に関しては、背景・展開・影響の三段構成で論述することが求められる。` +
      `【模範解答例】${era}における${topic}は、社会や政治の変化と密接に関連し、` +
      `その歴史的意義を${length}字程度でまとめることができる。`;
    const outline = `①背景の説明\n②主要な出来事や制度\n③社会・政治・文化への影響\n④歴史的意義のまとめ`;
    return { text, model, outline };
  }

  // 問題選択（必ず模範解答＆骨子付き）
  function pickQuestion(era, topic, length) {
    let filtered = questions.filter(q => q.era === era && q.topic === topic);
    if (filtered.length === 0) filtered = questions.filter(q => q.era === era);
    if (filtered.length === 0) filtered = questions.filter(q => q.topic === topic);

    if (filtered.length > 0) {
      return filtered[Math.floor(Math.random()*filtered.length)];
    } else {
      // 問題バンクに存在しない場合はテンプレ生成
      const text = `${era}の${topic}に関する論述問題を作成しなさい。`;
      return autoGenerateAnswer(era, topic, length, text);
    }
  }

  // 問題生成
  function generateQuestion() {
    const era = document.getElementById('era').value;
    const topic = document.getElementById('topic').value;
    let length = document.getElementById('length').value;
    if (length === "ランダム") { length = getRandomLength(); }

    const q = pickQuestion(era, topic, length);

    document.getElementById('question').innerText =
      `【${length}字】\n問題: ${q.text}\n\n模範解答:\n${q.model}\n\n答案の骨子:\n${q.outline}`;
  }
</script>
