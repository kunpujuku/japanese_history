<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>薫風塾 日本史論述問題ジェネレーター</title>
  <style>
    body {
      font-family: "Yu Gothic", "Hiragino Kaku Gothic ProN", sans-serif;
      margin: 20px;
      background: #fdfdfd;
      color: #333;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      border-bottom: 3px solid #006400;
    }
    header h1 {
      font-size: 2em;
      margin: 0;
      color: #006400;
    }
    .logo {
      font-weight: bold;
      font-size: 2.2em;
      color: #228B22;
    }
    .controls {
      margin: 15px 0;
    }
    label {
      margin-right: 10px;
    }
    select, button, input {
      margin: 5px;
      padding: 5px 10px;
    }
    #question {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
      background: #fafafa;
      min-height: 100px;
      white-space: pre-wrap;
    }
    .actions {
      margin-top: 15px;
    }
    @media print {
      header { border: none; }
      button, input, select { display: none; }
      body { color: black; background: white; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">薫風塾</div>
    <h1>東大レベル 日本史論述問題ジェネレーター</h1>
  </header>

  <div class="controls">
    <label for="era">時代:</label>
    <select id="era">
      <option value="古代">古代</option>
      <option value="中世">中世</option>
      <option value="近世">近世</option>
      <option value="近代">近代</option>
      <option value="現代">現代</option>
    </select>

    <label for="topic">トピック:</label>
    <select id="topic">
      <option value="政治">政治</option>
      <option value="経済">経済</option>
      <option value="社会">社会</option>
      <option value="文化">文化</option>
      <option value="外交">外交</option>
    </select>

    <label for="length">文字数:</label>
    <select id="length">
      <option value="ランダム">ランダム</option>
      <option value="100">100字</option>
      <option value="200">200字</option>
      <option value="400">400字</option>
      <option value="600">600字</option>
    </select>
  </div>

  <div class="actions">
    <button onclick="generateQuestion()">問題を生成</button>
    <button onclick="generateSet()">模試用セット作成</button>
    <button onclick="downloadPDF()">PDFダウンロード</button>
    <button onclick="downloadCSV()">CSVダウンロード</button>
    <input type="file" id="fileInput" accept=".json,.csv" onchange="loadQuestions(event)">
  </div>

  <div id="question">ここに問題と模範解答・骨子が表示されます</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // 問題バンク（模範解答・骨子付き）
    let questions = [
      {
        era:"近代",
        topic:"外交",
        text:"日清戦争と日露戦争の意義を比較しつつ、日本の国際的地位の変化について論じなさい。",
        model:"日清戦争により日本は清に勝利し、下関条約で領土と賠償金を獲得したが、三国干渉で譲歩を余儀なくされた。日露戦争では欧米列強に対抗して勝利し、ポーツマス条約で権益を得て国際的地位を大幅に高めた。両戦争を比較すると、日本が東アジアで勢力を拡大しつつ、列強の一員として認められる契機となった点に意義がある。",
        outline:"①日清戦争の勝利と下関条約の成果\n②三国干渉による制約\n③日露戦争勝利とポーツマス条約\n④欧米列強からの評価上昇\n⑤日本の国際的地位確立"
      },
      {
        era:"中世",
        topic:"政治",
        text:"鎌倉幕府の御成敗式目の意義について、武家社会の成立と関連づけて説明しなさい。",
        model:"御成敗式目は1232年に北条泰時が制定した武家法で、武士の慣習を成文化し、訴訟基準を明確にした。その結果、武士の法的秩序が確立し、幕府の統治の正当性が強化された。これにより武家社会の基盤が整い、以後の武家政権に継承された点で重要である。",
        outline:"①制定背景：承久の乱後の支配安定\n②内容：武士慣習の明文化\n③効果：訴訟基準の統一\n④幕府権威の正当化\n⑤武家社会の基盤確立"
      },
      {
        era:"近世",
        topic:"経済",
        text:"江戸時代の五街道の整備が経済や文化に与えた影響について述べなさい。",
        model:"五街道の整備は参勤交代や物資輸送の効率化を促し、商業や交通が発展した。また街道沿いの宿場町が繁栄し、文化や情報の流通も加速した。これにより江戸を中心とする全国的な市場経済と文化圏の形成が進展した。",
        outline:"①参勤交代制度との関係\n②物流の効率化\n③宿場町の繁栄\n④文化・情報の交流\n⑤全国市場と文化圏の形成"
      },
      {
        era:"現代",
        topic:"社会",
        text:"高度経済成長期の日本社会の変化について、都市化の観点から論じなさい。",
        model:"高度経済成長期には農村から都市への人口流入が急増し、都市部の工業・サービス業が発展した。結果として住宅不足や公害などの都市問題が生じたが、生活水準や教育水準の向上も見られた。都市化は日本社会の構造を大きく変えた要因である。",
        outline:"①農村から都市への人口移動\n②工業・サービス業の発展\n③住宅不足・公害などの課題\n④生活水準・教育水準の向上\n⑤社会構造の変化"
      },
      {
        era:"古代",
        topic:"文化",
        text:"奈良時代の仏教文化の特徴と、その政治への影響について論じなさい。",
        model:"奈良時代には聖武天皇のもとで国家仏教が推進され、大仏建立や国分寺の設置が行われた。仏教は鎮護国家思想と結びつき、政治的安定を図る手段となった。他方で仏教勢力の政治介入も進み、のちの政争の要因ともなった。",
        outline:"①国家仏教の推進\n②大仏建立と国分寺設置\n③鎮護国家思想との結びつき\n④政治安定の手段\n⑤仏教勢力の政治介入"
      }
    ];

    function getRandomLength(){
      const lengths = [100,200,400,600];
      return lengths[Math.floor(Math.random()*lengths.length)];
    }

    // 問題生成
    function generateQuestion(){
      const era = document.getElementById('era').value;
      const topic = document.getElementById('topic').value;
      let length = document.getElementById('length').value;
      if(length === "ランダム"){ length = getRandomLength(); }

      const filtered = questions.filter(q=>q.era===era && q.topic===topic);
      let q;
      if(filtered.length>0){
        q = filtered[Math.floor(Math.random()*filtered.length)];
      } else {
        q = {text: `${era}の${topic}に関する論述問題を作成しなさい。`, model:"（模範解答は準備中）", outline:"（骨子は準備中）"};
      }

      document.getElementById('question').innerText = 
        `【${length}字】\n問題: ${q.text}\n\n模範解答:\n${q.model}\n\n答案の骨子:\n${q.outline}`;
    }

    // 模試用セット（3問）
    function generateSet(){
      let output = "模試用セット（各問題に解答字数を指定）\n\n";
      for(let i=1;i<=3;i++){
        const era = ["古代","中世","近世","近代","現代"][Math.floor(Math.random()*5)];
        const topic = ["政治","経済","社会","文化","外交"][Math.floor(Math.random()*5)];
        const length = getRandomLength();
        const filtered = questions.filter(q=>q.era===era && q.topic===topic);
        let q;
        if(filtered.length>0){
          q = filtered[Math.floor(Math.random()*filtered.length)];
        } else {
          q = {text: `${era}の${topic}に関する論述問題を作成しなさい。`, model:"（模範解答は準備中）", outline:"（骨子は準備中）"};
        }
        output += `${i}. 【${length}字】\n問題: ${q.text}\n模範解答: ${q.model}\n骨子: ${q.outline}\n\n`;
      }
      document.getElementById('question').innerText = output;
    }

    // PDF出力
    async function downloadPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const text = document.getElementById('question').innerText;
      doc.setFontSize(12);
      doc.text(text, 10, 10, {maxWidth:180});
      doc.save("論述問題.pdf");
    }

    // CSV出力
    function downloadCSV(){
      const text = document.getElementById('question').innerText.replace(/\n/g,",");
      const blob = new Blob([text], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "questions.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    // 外部問題バンク読み込み
    function loadQuestions(event){
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e){
        let content = e.target.result;
        if(file.name.endsWith(".json")){
          const newQs = JSON.parse(content);
          questions = questions.concat(newQs);
          alert("JSON問題バンクを読み込みました！");
        } else if(file.name.endsWith(".csv")){
          const lines = content.split("\n");
          lines.forEach(line=>{
            const [era,topic,text,model,outline] = line.split(",");
            if(era && topic && text){
              questions.push({era, topic, text, model:model||"", outline:outline||""});
            }
          });
          alert("CSV問題バンクを読み込みました！");
        }
      };
      reader.readAsText(file,"UTF-8");
    }
  </script>
</body>
</html>
